flow_model:
  _target_: src.internal_flow.flow.InpaintingFlow
  path:
    _target_: src.flows.path.AffinePath
    scheduler:
      _target_: src.flows.schedulers.OTScheduler
  loss_fn:
    _target_: src.flows.losses.MSEFlowMatchingLoss
  cfg:
    _target_: src.flows.types.FlowConfig
    predicts: x_1
    guidance: CFG
    guidance_scale: 1.0
    guided_prob: 1.0
  solver_cfg:
    method: euler
    n_steps: 100
  optimizer_cfg:
    _target_: torch.optim.Adam
    _partial_: true
    lr: 0.0001
    weight_decay: 0.0001
    betas:
    - 0.9
    - 0.999
  viz: ${viz}
  ema_decay: 0.9999
  model:
    _target_: src.internal_flow.model.Model
    n_channels: 32
    output_dim: 3
    in_dim: 4
trainer:
  _target_: pytorch_lightning.Trainer
  log_every_n_steps: 10
  num_sanity_val_steps: 2
  check_val_every_n_epoch: 1
  accelerator: gpu
  devices: auto
  callbacks:
  - _target_: pytorch_lightning.callbacks.TQDMProgressBar
    refresh_rate: 10
    leave: true
  - _target_: pytorch_lightning.callbacks.ModelCheckpoint
    dirpath: checkpoints/
    every_n_train_steps: 100
    filename: '{epoch:02d}-{step:04d}'
    save_last: true
  max_epochs: 40
  precision: bf16-mixed
  accumulate_grad_batches: 8
  gradient_clip_val: 1.0
  deterministic: true
  strategy: ddp
  logger:
  - _target_: pytorch_lightning.loggers.WandbLogger
    project: StageTests
    name: monoimage
    save_dir: wandb/
    log_model: true
data:
  train_loader:
    _target_: torch.utils.data.DataLoader
    batch_size: 240
    num_workers: 8
    pin_memory: true
    dataset:
      _target_: src.internal_flow.data.TrainOverride
      image_path: ${image_path}
      mask_path: ${mask_path}
      seed: ${seed}
      sigma: 0.6
  test_loader:
    _target_: torch.utils.data.DataLoader
    batch_size: 1
    num_workers: 0
    pin_memory: true
    dataset:
      _target_: src.internal_flow.data.TestOverride
      image_path: ${image_path}
      mask_path: ${mask_path}
      seed: ${seed}
run_name: ${next_version:outputs}
image_path: data/example_images/1.png
mask_path: data/example_images/mask2.png
viz: true
seed: 42
